/***
 * MyShopUI interface de démarrage
 * Dispatch vers le controller ad hoc
 *
 * MyShopUI Application
 *
 * @package    MyShopUI
 * @author     Kevin Fabre
 * @email      ariga@hotmail.fr
 * @copyright  Ariga 2023
 * @license    https://www.gnu.org/licenses/gpl-3.0.en.html  GNU General Public License
 * @version    1.0.0
 ***/
"use strict";docReady(()=>{function e(e){e.preventDefault();const t=function(){const e=new FormData;return null!==i&&""!==i.value&&e.append("name",i.value),null!==u&&""!==u.value&&e.append("surname",u.value),null!==A&&""!==A.value&&e.append("collections_id",A.value),null!==j&&""!==j.value&&e.append("sub_collection_name",j.value),null!==d&&""!==d.value&&e.append("description",d.value),null!==F&&e.append("translate_x",F.value),null!==P&&e.append("translate_y",P.value),null!==m&&""!==m.value&&e.append("id",m.value),null!==p&&""!==p.value&&e.append("name",p.value),null!==h&&e.append("link",h.value),null!==g&&e.append("tab",g.value),null!==X&&void 0!==X.files[0]&&void 0!==typeof X.files[0].length&&e.append("image",X.files[0]),null!==w&&e.append("MYSHOP_CSRF_TOKEN_SESS_IDX",w.value),null!==v&&e.append("delete_image_path",v.value),e}();var n=new XMLHttpRequest;n.open("POST","/admin/post","admin/post"),n.send(t),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var e=JSON.parse(n.responseText);(e.message="success")?document.getElementById("message").innerHTML='<div class="alert alert-success"><strong>L\'image a été enregistré avec succès</strong></div>':document.getElementById("message").innerHTML='<div class="alert alert-danger">'+e.message+"</div>",setTimeout(function(){document.getElementById("message").innerHTML=""},5e3)}}}const t=document,n=t.querySelector(".modal"),l=(t.querySelector("#modalBtn"),t.querySelector("#navloginBtn")),a=(t.getElementsByClassName("close")[0],t.querySelector("#loginBtn")),o=t.querySelectorAll(".logoutBtn"),r=t.querySelector("#password_confirm"),s=t.querySelector("#password"),c=t.querySelector("#loginContainer"),i=t.querySelector("#name"),u=t.querySelector("#surname"),d=t.querySelector("#description"),m=t.querySelector("#itemID"),p=t.querySelector("#instagramName"),h=t.querySelector("#instagramAddress"),g=t.querySelector("#tabName"),v=t.querySelector("#delete_image_path"),y=t.querySelector("#registerBtn"),S=document.querySelector("#Gallery_container"),f=t.querySelector('meta[name="csrf-token"]').content,q=t.querySelector("#email"),w=t.querySelector("#MYSHOP_CSRF_TOKEN_SESS_IDX"),L=t.querySelector("#deleteBtn"),E=t.querySelector("#homeImageIDSelector"),_=t.querySelector(".afterheader "),T={credentials:"same-origin","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":f,cache:"no-cache","Cache-Control":"no-store, no-transform, max-age=0, private","Content-Type":"application/json"},b={"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":f,cache:"no-cache","Cache-Control":"no-store, no-transform, max-age=0, private","Content-Type":"application/json"};let H,I=t.querySelector("#homedropdowntoggle"),k=t.querySelector("#dropdown"),B=t.querySelector("#frontpageimage"),C=t.querySelector("#frontpagecontainer"),M=t.querySelectorAll(".nav-item"),N=t.querySelector("#header_admin"),x=(t.querySelectorAll(".logohomepage"),t.querySelectorAll(".change_color_white")),A=t.querySelector("#collection-selector"),O=t.querySelector("#collections_id"),R=t.querySelector("#sub_collection_selector"),j=t.querySelector("#sub_collection_name"),X=t.querySelector("#chooseFile"),J=(t.querySelector("#frontpagecontainer"),document.querySelectorAll(".preview-selected-image")),D=document.querySelector("#preview-selected-home-image"),F=t.querySelector("#image_translateX_selector"),P=t.querySelector("#image_translateY_selector");const K=document.querySelector("#formtab");null!==l&&(l.onclick=function(){n.style.display="block"});const U=()=>{c.classList.add("error"),console.log("hello"),setTimeout(()=>{c.classList.remove("error")},1e3)};null!==a&&a.addEventListener("click",e=>{0===q.value.length||0===s.value.length?U():fetch("/connect",{headers:T,method:"post",redirect:"follow",body:JSON.stringify({type:"cnx",action:"connect",email:window.btoa(AesJson.encrypt(q.value,f)),password:window.btoa(AesJson.encrypt(s.value,f))})}).then(e=>e.json()).then(e=>{401===e.status&&"cnx"===e.action&&!1===e.connected?U():200===e.status&&"cnx"===e.action&&!0===e.connected&&(window.location.href="/admin")})}),null!==o&&o.forEach(e=>{e.addEventListener("click",e=>{fetch("/disconnect",{headers:T,method:"post",redirect:"follow",body:JSON.stringify({type:"cnx",action:"disconnect"})}).then(e=>e.json()).then(e=>{200===e.status&&"disconnect"===e.action&&!0===e.disconnected&&(t.location.href="/")})})}),null!==y&&y.addEventListener("click",e=>{0===q.value.length||0===s.value.length||r.value!==s.value?U():argon2.hash({pass:s.value,salt:CryptoJS.SHA3(q.value).toString(CryptoJS.enc.Hex),time:4,mem:8192,hashLen:64,parallelism:8,type:argon2.ArgonType.Argon2id}).then(e=>{fetch("?action=register",{headers:T,method:"post",body:JSON.stringify({type:"cnx",action:"register",email:window.btoa(q.value),password:window.btoa(e.encoded),nom:i.value,prenom:u.value})}).then(e=>e.json()).then(e=>{401===e.status&&"cnx"===e.action&&!1===e.connected?U():200===e.status&&"cnx"===e.action&&!0===e.connected&&(t.location.href="/")})})}),window.addEventListener("keydown",function(e){if(("U+000A"==e.keyIdentifier||"Enter"==e.keyIdentifier||13==e.keyCode)&&"INPUT"==e.target.nodeName&&"text"==e.target.type)return e.preventDefault(),!1},!0),null==B&&null!==C&&null==N&&(M.forEach(e=>{e.children[0].classList.replace("headerwhite","headerbrown")}),t.querySelector("#instagramlogo").src="/assets/imgs/instagram-brown.png"),document.addEventListener("click",e=>{let t=e.target;if(null!==I){do{if(t==I)return void k.classList.toggle("show");t=t.parentNode}while(t);k.classList.contains("show")&&k.classList.remove("show")}}),null!==A&&A.addEventListener("change",e=>{"Pas dans une collection"==A.value?O.value=null:O.value=A.value}),null!==R&&R.addEventListener("change",e=>{"Pas dans une sous-collection"==R.value?j.value="":j.value=R.value}),null!==X&&X.addEventListener("change",e=>{const t=e.target.files;t.length>0&&(H=URL.createObjectURL(t[0]),null!==C?(D.src=H,D.style.display="block",D.classList.add("frontpageimage"),M.forEach(e=>{e.children[0].classList.replace("headerbrown","headerwhite")}),N.classList.remove("navbar-background-color"),x.forEach(e=>{e.style.color="white"})):J.forEach(e=>{e.src=H}))}),null!==F&&F.addEventListener("change",()=>{null!==J&&J.forEach(e=>{e.style.transform=`translate(${F.value}%,\n                         ${P.value}%)`})}),null!==P&&P.addEventListener("change",()=>{null!==J&&J.forEach(e=>{e.style.transform=`translate(${F.value}%,\n                         ${P.value}%)`})}),stop=!1;let G=!1;var Y=1;if($(document).scroll(function(e){if($(document).scrollTop()>=$(document).height()-$(window).height()){if(1==G||1==stop)return;(function(e){window.location.pathname.includes("admin")||(G=!0,fetch(window.location.pathname+"/"+e,{method:"GET",headers:b}).then(e=>e.json()).then(e=>{S.insertAdjacentHTML("beforeend",e.html),""!=e.html&&"\r\n"!=e.html||(stop=!0),G=!1}))})(++Y)}}),null!==K&&K.addEventListener("submit",e),null!==L&&L.addEventListener("click",e=>{if(null!==m&&""==m.value)return document.getElementById("message").innerHTML='<div class="alert alert-danger">Vous n\'avez pas sélectionné de collection à supprimer</div>',void setTimeout(function(){document.getElementById("message").innerHTML=""},5e3);fetch("/admin/post",{headers:T,method:"post",body:JSON.stringify({action:"delete",tab:g.value,id:m.value})}).then(e=>e.json()).then(e=>{"success"==e.message?(document.getElementById("message").innerHTML='<div class="alert alert-success"><strong>L\'élément a bien été supprimé</strong></div>',setTimeout(function(){let e=window.location.pathname,t=(e=e.split("/")).slice(-1);(e=e.split("/")).pop(),e=e.join("/"),parseInt(t)>0?window.location.href=e:location.reload()},5e3)):(document.getElementById("message").innerHTML="<div class=\"alert alert-danger\">Lélément n'a  pas pu être supprimé ou n'existe plus</div>",setTimeout(function(){document.getElementById("message").innerHTML=""},5e3))})}),null!==E){let e=!1;E.addEventListener("change",function(t){fetch("/admin/home-image/"+E.value,{method:"GET",headers:b}).then(e=>e.json()).then(t=>{""!==t.html&&(_.innerHTML=t.html,e=!0)}).then(e=>{})}),!0===e&&(D.src=v.value,D.style.display="block",D.classList.add("frontpageimage"),e=!1)}});