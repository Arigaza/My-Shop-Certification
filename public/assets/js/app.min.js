/***
 * MyShopUI interface de démarrage
 * Dispatch vers le controller ad hoc
 *
 * MyShopUI Application
 *
 * @package    MyShopUI
 * @author     Kevin Fabre
 * @email      ariga@hotmail.fr
 * @copyright  Ariga 2023
 * @license    https://www.gnu.org/licenses/gpl-3.0.en.html  GNU General Public License
 * @version    1.0.0
 ***/
"use strict";docReady(()=>{function e(e){e.preventDefault();const t=function(){const e=new FormData;return null!==c&&""!==c.value&&e.append("name",c.value),null!==i&&""!==i.value&&e.append("surname",i.value),null!==x&&""!==x.value&&e.append("collections_id",x.value),null!==R&&""!==R.value&&e.append("sub_collection_name",R.value),null!==u&&""!==u.value&&e.append("description",u.value),null!==D&&e.append("translate_x",D.value),null!==F&&e.append("translate_y",F.value),null!==d&&""!==d.value&&e.append("id",d.value),null!==m&&""!==m.value&&e.append("name",m.value),null!==p&&e.append("link",p.value),null!==g&&e.append("tab",g.value),null!==j&&void 0!==j.files[0]&&void 0!==typeof j.files[0].length&&e.append("image",j.files[0]),null!==q&&e.append("MYSHOP_CSRF_TOKEN_SESS_IDX",q.value),null!==h&&e.append("delete_image_path",h.value),e}();var n=new XMLHttpRequest;n.open("POST","/admin/post","admin/post"),n.send(t),n.onreadystatechange=function(){if(4==n.readyState&&200==n.status){var e=JSON.parse(n.responseText);(e.message="success")?document.getElementById("message").innerHTML='<div class="alert alert-success"><strong>L\'image a été enregistré avec succès</strong></div>':document.getElementById("message").innerHTML='<div class="alert alert-danger">'+e.message+"</div>",setTimeout(function(){document.getElementById("message").innerHTML=""},5e3)}}}const t=document,n=t.querySelector(".modal"),l=(t.querySelector("#modalBtn"),t.querySelector("#navloginBtn")),a=(t.getElementsByClassName("close")[0],t.querySelector("#loginBtn")),o=(t.querySelector("#logout"),t.querySelector("#password_confirm")),r=t.querySelector("#password"),s=t.querySelector("#loginContainer"),c=t.querySelector("#name"),i=t.querySelector("#surname"),u=t.querySelector("#description"),d=t.querySelector("#itemID"),m=t.querySelector("#instagramName"),p=t.querySelector("#instagramAddress"),g=t.querySelector("#tabName"),h=t.querySelector("#delete_image_path"),v=t.querySelector("#registerBtn"),y=document.querySelector("#Gallery_container"),S=t.querySelector('meta[name="csrf-token"]').content,f=t.querySelector("#email"),q=t.querySelector("#MYSHOP_CSRF_TOKEN_SESS_IDX"),w=t.querySelector("#deleteBtn"),L=t.querySelector("#homeImageIDSelector"),E=t.querySelector(".afterheader "),_={credentials:"same-origin","X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":S,cache:"no-cache","Cache-Control":"no-store, no-transform, max-age=0, private","Content-Type":"application/json"},T={"X-Requested-With":"XMLHttpRequest","X-CSRF-TOKEN":S,cache:"no-cache","Cache-Control":"no-store, no-transform, max-age=0, private","Content-Type":"application/json"};let b,H=t.querySelector("#homedropdowntoggle"),I=t.querySelector("#dropdown"),k=t.querySelector("#frontpageimage"),C=t.querySelector("#frontpagecontainer"),M=t.querySelectorAll(".nav-item"),B=t.querySelector("#header_admin"),N=(t.querySelectorAll(".logohomepage"),t.querySelectorAll(".change_color_white")),x=t.querySelector("#collection-selector"),A=t.querySelector("#collections_id"),O=t.querySelector("#sub_collection_selector"),R=t.querySelector("#sub_collection_name"),j=t.querySelector("#chooseFile"),X=(t.querySelector("#frontpagecontainer"),document.querySelectorAll(".preview-selected-image")),J=document.querySelector("#preview-selected-home-image"),D=t.querySelector("#image_translateX_selector"),F=t.querySelector("#image_translateY_selector");const P=document.querySelector("#formtab");null!==l&&(l.onclick=function(){n.style.display="block"});const K=()=>{s.classList.add("error"),console.log("hello"),setTimeout(()=>{s.classList.remove("error")},1e3)};null!==a&&a.addEventListener("click",e=>{0===f.value.length||0===r.value.length?K():fetch("/connect",{headers:_,method:"post",redirect:"follow",body:JSON.stringify({type:"cnx",action:"connect",email:window.btoa(AesJson.encrypt(f.value,S)),password:window.btoa(AesJson.encrypt(r.value,S))})}).then(e=>e.json()).then(e=>{401===e.status&&"cnx"===e.action&&!1===e.connected?K():200===e.status&&"cnx"===e.action&&!0===e.connected&&(window.location.href="/admin")})}),null!==v&&v.addEventListener("click",e=>{0===f.value.length||0===r.value.length||o.value!==r.value?K():argon2.hash({pass:r.value,salt:CryptoJS.SHA3(f.value).toString(CryptoJS.enc.Hex),time:4,mem:8192,hashLen:64,parallelism:8,type:argon2.ArgonType.Argon2id}).then(e=>{fetch("?action=register",{headers:_,method:"post",body:JSON.stringify({type:"cnx",action:"register",email:window.btoa(f.value),password:window.btoa(e.encoded),nom:c.value,prenom:i.value})}).then(e=>e.json()).then(e=>{401===e.status&&"cnx"===e.action&&!1===e.connected?K():200===e.status&&"cnx"===e.action&&!0===e.connected&&(t.location.href="/")})})}),window.addEventListener("keydown",function(e){if(("U+000A"==e.keyIdentifier||"Enter"==e.keyIdentifier||13==e.keyCode)&&"INPUT"==e.target.nodeName&&"text"==e.target.type)return e.preventDefault(),!1},!0),null==k&&null!==C&&null==B&&(M.forEach(e=>{e.children[0].classList.replace("headerwhite","headerbrown")}),t.querySelector("#instagramlogo").src="/assets/imgs/instagram-brown.png"),document.addEventListener("click",e=>{let t=e.target;if(null!==H){do{if(t==H)return void I.classList.toggle("show");t=t.parentNode}while(t);I.classList.contains("show")&&I.classList.remove("show")}}),null!==x&&x.addEventListener("change",e=>{"Pas dans une collection"==x.value?A.value=null:A.value=x.value}),null!==O&&O.addEventListener("change",e=>{"Pas dans une sous-collection"==O.value?R.value="":R.value=O.value}),null!==j&&j.addEventListener("change",e=>{const t=e.target.files;t.length>0&&(b=URL.createObjectURL(t[0]),null!==C?(J.src=b,J.style.display="block",J.classList.add("frontpageimage"),M.forEach(e=>{e.children[0].classList.replace("headerbrown","headerwhite")}),B.classList.remove("navbar-background-color"),N.forEach(e=>{e.style.color="white"})):X.forEach(e=>{e.src=b}))}),null!==D&&D.addEventListener("change",()=>{null!==X&&X.forEach(e=>{e.style.transform=`translate(${D.value}%,\n                         ${F.value}%)`})}),null!==F&&F.addEventListener("change",()=>{null!==X&&X.forEach(e=>{e.style.transform=`translate(${D.value}%,\n                         ${F.value}%)`})}),stop=!1;let U=!1;var G=1;if($(document).scroll(function(e){if($(document).scrollTop()>=$(document).height()-$(window).height()){if(1==U||1==stop)return;(function(e){window.location.pathname.includes("admin")||(U=!0,fetch(window.location.pathname+"/"+e,{method:"GET",headers:T}).then(e=>e.json()).then(e=>{y.insertAdjacentHTML("beforeend",e.html),""!=e.html&&"\r\n"!=e.html||(stop=!0),U=!1}))})(++G)}}),null!==P&&P.addEventListener("submit",e),null!==w&&w.addEventListener("click",e=>{if(null!==d&&""==d.value)return document.getElementById("message").innerHTML='<div class="alert alert-danger">Vous n\'avez pas sélectionné de collection à supprimer</div>',void setTimeout(function(){document.getElementById("message").innerHTML=""},5e3);fetch("/admin/post",{headers:_,method:"post",body:JSON.stringify({action:"delete",tab:g.value,id:d.value})}).then(e=>e.json()).then(e=>{"success"==e.message?(document.getElementById("message").innerHTML='<div class="alert alert-success"><strong>L\'élément a bien été supprimé</strong></div>',setTimeout(function(){let e=window.location.pathname,t=(e=e.split("/")).slice(-1);(e=e.split("/")).pop(),e=e.join("/"),parseInt(t)>0?window.location.href=e:location.reload()},5e3)):(document.getElementById("message").innerHTML="<div class=\"alert alert-danger\">Lélément n'a  pas pu être supprimé ou n'existe plus</div>",setTimeout(function(){document.getElementById("message").innerHTML=""},5e3))})}),null!==L){let e=!1;L.addEventListener("change",function(t){fetch("/admin/home-image/"+L.value,{method:"GET",headers:T}).then(e=>e.json()).then(t=>{""!==t.html&&(E.innerHTML=t.html,e=!0)}).then(e=>{})}),!0===e&&(J.src=h.value,J.style.display="block",J.classList.add("frontpageimage"),e=!1)}});